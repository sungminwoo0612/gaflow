# CVAT analytics - log collector (HTTP 8282) -> ClickHouse
# Ref: https://github.com/cvat-ai/cvat/blob/develop/components/analytics/vector/vector.toml

data_dir = "/vector-data-dir"

[sources.http-events]
type = "http_server"
address = "0.0.0.0:8282"
encoding = "json"

[sinks.clickhouse]
inputs = ["http-events"]
type = "clickhouse"
database = "${CLICKHOUSE_DB}"
table = "events"
auth.strategy = "basic"
auth.user = "${CLICKHOUSE_USER}"
auth.password = "${CLICKHOUSE_PASSWORD}"
endpoint = "http://${CLICKHOUSE_HOST}:${CLICKHOUSE_PORT}"
request.concurrency = "adaptive"
encoding.only_fields = [
  "scope",
  "obj_name",
  "obj_id",
  "obj_val",
  "source",
  "timestamp",
  "count",
  "duration",
  "project_id",
  "task_id",
  "job_id",
  "user_id",
  "user_name",
  "user_email",
  "org_id",
  "org_slug",
  "payload",
  "access_token_id",
]
